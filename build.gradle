plugins {
    id 'application'
}

allprojects {

    group 'eu.koboo'
    version '2.2.2'

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    repositories {
        mavenCentral()
        maven {
            url 'http://repo.koboo.eu/releases'
        }
    }

    compileJava.options.encoding = 'UTF-8'
    tasks.withType(JavaCompile) {
        options.encoding = 'UTF-8'
    }
}

mainClassName = "UDSTest"

dependencies {

    testCompile group: 'junit', name: 'junit', version: '4.13.1'
    testCompile group: 'com.carrotsearch', name: 'junit-benchmarks', version: '0.7.2'

    testCompile group: 'eu.koboo', name: 'serial-elsa', version: '1.2.1'
    testCompile group: 'eu.koboo', name: 'serial-fst', version: '1.2.1'
    testCompile group: 'eu.koboo', name: 'serial-hessian', version: '1.2.1'
    testCompile group: 'eu.koboo', name: 'serial-kryo', version: '1.2.1'

    compile project('netty-core')
    compile project('netty-client')
    compile project('netty-server')
}

test {
    exclude '*'
}

jar {
    from {
        configurations.compile.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
    manifest {
        attributes(
                'Main-Class': mainClassName,
        )
    }
}

subprojects {

    apply plugin: 'java'
    apply plugin: 'maven-publish'

    publishing {
        repositories {
            maven {
                url = 'http://repo.koboo.eu/releases'
                credentials {
                    username = System.getenv('REPO_USER')
                    password = System.getenv('REPO_TOKEN')
                }
            }
        }
        publications {
            maven(MavenPublication) {
                from components.java
            }
        }
    }
}